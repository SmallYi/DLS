{% extends 'base.html' %}
 
{% block title %}模型创建成功{% endblock %}
 
{% block icon_title %} {% endblock %}

{% block head %} {% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-6 col-md-offset-3" style="height: 500px">
            <div id="prog" class="col-md-12 progress" style="position: absolute; bottom: 0;">
                <div id="prog-b" class="progress-bar" role="progressbar" style="width: 0%;">

                </div>
            </div>
        </div>
        <div class="col-md-6 col-md-offset-3">
            <div class="col-md-12">
                <p id="dcp" style="text-align:center; font-size:2em; color:azure">模型添加中...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %} 
<script>
    var socket;
    var a = new Array(), i = 0;
    function connect() {
        var host = "ws://192.168.1.24:3368/ws";
        socket = new WebSocket(host);
        try {
            socket.onopen = function (msg) {
                alert("连接成功！");
                var ms = localStorage.getItem('uid');
                socket.send(ms);
            };
            socket.onmessage = function (msg) {
                if (typeof msg.data == "string") {
                    ReceiveProgressData(msg.data);
                    i++;
                }
            };
            socket.onclose = function (msg) {
                alert("socket closed!");
             };
        }
        catch (ex) {
            log(ex);
        }
    }
    //获取进度条数据
    function ReceiveProgressData(msg) {
        var obj = JSON.parse(msg);          
        if (obj.type == 'progress') {
            if (obj.data == '0') {
                $("#prog-b").animate({
                    width: '0%'
                });
                $("#dcp").text(obj.description);
            } else {
                $("#prog-b").animate({
                    width: obj.data + '%'
                });
                $("#dcp").text(obj.description);
            }
        }
    }
    
    window.onbeforeunload = function () {
        try {
            socket.close();
            socket = null;
        }
        catch (ex) {
        }
    };

    function onkey(event) { if (event.keyCode == 13) { send(); } }

    $(document).ready(function(){
        connect();
    });
</script>
{% endblock %}
